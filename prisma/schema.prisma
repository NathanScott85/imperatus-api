datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model File {
  id          Int      @id @default(autoincrement())
  url         String
  key         String
  fileName    String   @unique
  contentType String
  createdAt   DateTime @default(now())

  category Category? @relation("CategoryImage")
  product  Product?  @relation("ProductImage")
}

model Category {
  id          Int       @id @default(autoincrement())
  name        String    @unique
  description String
  imgId       Int?      @unique
  products    Product[]

  img File? @relation("CategoryImage", fields: [imgId], references: [id])
}

model Product {
  id          Int    @id @default(autoincrement())
  categoryId  Int
  imgId       Int?   @unique
  name        String
  price       Float
  type        String
  rrp         Float?
  description String
  stock       Stock?

  category Category @relation(fields: [categoryId], references: [id])
  img      File?    @relation("ProductImage", fields: [imgId], references: [id])
}

model Stock {
  id        Int     @id @default(autoincrement())
  amount    Int
  sold      Int
  instock   String
  soldout   String
  preorder  String
  product   Product @relation(fields: [productId], references: [id])
  productId Int     @unique
}

model User {
  id                      Int                      @id @default(autoincrement())
  email                   String                   @unique
  fullname                String
  password                String
  dob                     DateTime
  phone                   String
  address                 String
  city                    String
  postcode                String
  resetToken              String?
  resetTokenExpiry        DateTime?
  emailVerified           Boolean                  @default(false)
  verificationToken       String?
  verificationTokenExpiry DateTime?
  userRoles               UserRole[]               @relation("UserRoles")
  refreshToken            String?
  refreshTokenExpiry      DateTime?
  storeCredit             Float                    @default(0.0)
  transactions            StoreCreditTransaction[]
}

model Role {
  id    Int        @id @default(autoincrement())
  name  String     @unique
  users UserRole[] @relation("UserRoles")
}

model UserRole {
  id     Int  @id @default(autoincrement())
  userId Int
  roleId Int
  user   User @relation("UserRoles", fields: [userId], references: [id])
  role   Role @relation("UserRoles", fields: [roleId], references: [id])

  @@unique([userId, roleId])
}

model StoreCreditTransaction {
  id           Int      @id @default(autoincrement())
  userId       Int
  date         DateTime
  time         String
  type         String
  amount       Float
  balanceAfter Float
  User         User     @relation(fields: [userId], references: [id])
}
