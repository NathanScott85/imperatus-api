datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model StoreCreditTransaction {
  id           Int      @id @default(autoincrement())
  userId       Int
  date         DateTime
  time         String  // Ensure this field exists
  type         String
  amount       Float
  balanceAfter Float
  User         User     @relation(fields: [userId], references: [id])
}

model User {
  id                      Int        @id @default(autoincrement())
  email                   String     @unique
  fullname                String
  password                String
  dob                     DateTime
  phone                   String
  address                 String
  city                    String
  postcode                String
  resetToken              String?
  resetTokenExpiry        DateTime?
  emailVerified           Boolean    @default(false)
  verificationToken       String?
  verificationTokenExpiry DateTime?
  userRoles               UserRole[] @relation("UserRoles")
  refreshToken            String?    // Store a single refresh token directly on the User model
  refreshTokenExpiry      DateTime?  // Store the expiry date of the refresh token
  storeCredit           Float     @default(0.0)
  transactions StoreCreditTransaction[]
}

model Role {
  id       Int        @id @default(autoincrement())
  name     String     @unique
  users    UserRole[] @relation("UserRoles")
}

model UserRole {
  id     Int  @id @default(autoincrement())
  userId Int
  roleId Int
  user   User @relation("UserRoles", fields: [userId], references: [id])
  role   Role @relation("UserRoles", fields: [roleId], references: [id])

  @@unique([userId, roleId])
}
